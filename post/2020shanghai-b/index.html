<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>2020shanghai B - 缓冲区结算、括号嵌套的递归 - luosuu的小站</title>
  <meta property="og:title" content="2020shanghai B - 缓冲区结算、括号嵌套的递归 - luosuu的小站" />
  <meta name="twitter:title" content="2020shanghai B - 缓冲区结算、括号嵌套的递归 - luosuu的小站" />
  <meta name="description" content="题面:https://ac.nowcoder.com/acm/contest/6871/B">
  <meta property="og:description" content="题面:https://ac.nowcoder.com/acm/contest/6871/B">
  <meta name="twitter:description" content="题面:https://ac.nowcoder.com/acm/contest/6871/B">
  <meta name="author" content="luosuu"/>
  <meta property="og:site_name" content="luosuu的小站" />
  <meta property="og:url" content="https://example.com/post/2020shanghai-b/" />
  <meta property="og:type" content="article" />
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.73.0" />

  <link rel="stylesheet" href="/css/style.css" media="all" />
  <link rel="stylesheet" href="/css/syntax.css" media="all" />
  <link rel="stylesheet" href="/css/custom.css" media="all" />

  <script src="/js/script.js"></script>
  <script src="/js/custom.js"></script>
  <script defer src="/js/fontawesome.js"></script>
</head>

<body>

<header class="site-header">
  <nav class="site-navi">
    <h1 class="site-title"><a href="/">luosuu的小站</a></h1>
    <ul class="site-navi-items">
      <li class="site-navi-item-categories"><a href="/categories/" title="Categories">Categories</a></li>
      <li class="site-navi-item-tags"><a href="/tags/" title="Tags">Tags</a></li>
      <li class="site-navi-item-archives"><a href="/archives/" title="Archives">Archives</a></li>
      <li class="site-navi-item-about"><a href="/about/" title="About">About</a></li>
    </ul>
  </nav>
</header>
<hr class="site-header-bottom">

  <div class="main" role="main">
    <article class="article">
      
      
      <h1 class="article-title">2020shanghai B - 缓冲区结算、括号嵌套的递归</h1>
      
      <hr class="article-title-bottom">
      <ul class="article-meta">
        <li class="article-meta-date"><time>August 6, 2020</time></li>
        <li class="article-meta-categories">
          <a href="/categories/sicp/">
            <i class="fas fa-folder"></i>
            sicp
          </a>&nbsp;
        </li>
      </ul>
      
<aside class="toc">
  
</aside>
      <p>题面:<a href="https://ac.nowcoder.com/acm/contest/6871/B">https://ac.nowcoder.com/acm/contest/6871/B</a></p>

<h2 id="分析">分析</h2>

<p>典型的字符串处理，而且出题人强调了没有括号嵌套（真亚撒西嘤嘤嘤）。</p>

<p>因为分子式不同部分的计算方式是不一样的，可以用缓冲的思想来解决这个问题。</p>

<p>在不考虑括号嵌套的情况下</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;string&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> ll;
string a;
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(){
    cin<span style="color:#f92672">&gt;&gt;</span>a;
    ll ans<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,cnt<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,res<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,sum<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> len<span style="color:#f92672">=</span>a.length();
    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;i<span style="color:#f92672">&lt;</span>a.length();)
    {
        <span style="color:#66d9ef">if</span>(a[i]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;C&#39;</span><span style="color:#f92672">||</span>a[i]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;H&#39;</span><span style="color:#f92672">||</span>a[i]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;O&#39;</span>){
             <span style="color:#66d9ef">if</span>(a[i]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;C&#39;</span>)cnt<span style="color:#f92672">=</span><span style="color:#ae81ff">13</span>;
              <span style="color:#66d9ef">if</span>(a[i]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;H&#39;</span>)cnt<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
            <span style="color:#66d9ef">if</span>(a[i]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;O&#39;</span>)cnt<span style="color:#f92672">=</span><span style="color:#ae81ff">17</span>;
            i<span style="color:#f92672">++</span>;
            res<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
            <span style="color:#66d9ef">while</span>(i<span style="color:#f92672">&lt;</span>len<span style="color:#f92672">&amp;&amp;</span>a[i]<span style="color:#f92672">&gt;=</span><span style="color:#e6db74">&#39;0&#39;</span><span style="color:#f92672">&amp;&amp;</span>a[i]<span style="color:#f92672">&lt;=</span><span style="color:#e6db74">&#39;9&#39;</span>){
                res<span style="color:#f92672">=</span>res<span style="color:#f92672">*</span><span style="color:#ae81ff">10</span><span style="color:#f92672">+</span>a[i]<span style="color:#f92672">-</span><span style="color:#e6db74">&#39;0&#39;</span>;
                i<span style="color:#f92672">++</span>;
            }
            <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>res)ans<span style="color:#f92672">+=</span>cnt;
            <span style="color:#66d9ef">else</span> ans<span style="color:#f92672">+=</span>cnt<span style="color:#f92672">*</span>res;
        }

        <span style="color:#75715e">//遇到左括号，就先把未加进最终结果的非括号内元素们算入结果，清空缓冲区，准备计算括号内的分子式
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span>(a[i]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;(&#39;</span><span style="color:#f92672">&amp;&amp;</span>i<span style="color:#f92672">&lt;</span>len){
          sum<span style="color:#f92672">+=</span>ans;
            ans<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
            i<span style="color:#f92672">++</span>;
        }
        <span style="color:#75715e">//遇到右括号，结算括号内部的
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span>(a[i]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;)&#39;</span><span style="color:#f92672">&amp;&amp;</span>i<span style="color:#f92672">&lt;</span>len){
            i<span style="color:#f92672">++</span>;
            res<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
             <span style="color:#66d9ef">while</span>(i<span style="color:#f92672">&lt;</span>len<span style="color:#f92672">&amp;&amp;</span>a[i]<span style="color:#f92672">&gt;=</span><span style="color:#e6db74">&#39;0&#39;</span><span style="color:#f92672">&amp;&amp;</span>a[i]<span style="color:#f92672">&lt;=</span><span style="color:#e6db74">&#39;9&#39;</span>){
                res<span style="color:#f92672">=</span>res<span style="color:#f92672">*</span><span style="color:#ae81ff">10</span><span style="color:#f92672">+</span>a[i]<span style="color:#f92672">-</span><span style="color:#e6db74">&#39;0&#39;</span>;
                i<span style="color:#f92672">++</span>;
            }
            <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>res)sum<span style="color:#f92672">+=</span>ans;
            <span style="color:#66d9ef">else</span> sum<span style="color:#f92672">+=</span>ans<span style="color:#f92672">*</span>res;
            ans<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
        }
    }
    sum<span style="color:#f92672">+=</span>ans;
    printf(<span style="color:#e6db74">&#34;%lld&#34;</span>,sum);
}
</code></pre></div>
<h3 id="用递归的方式处理括号嵌套">用递归的方式处理括号嵌套</h3>

<p>如果要考虑括号内部的嵌套，就需要用到递归的方法了。</p>

<p>先说缓冲区的部分，遇到常规字符<code>C</code>,<code>H</code>,<code>O</code>，将缓冲区算入结果，将常规字符的值读入缓冲区，以处理后面可能会出现的数字，括号等情况。</p>

<p>遇到左括号，也是先将缓冲区算入结果，然后进入下一层函数，计算括号内部的分子式，遇到右括号时内部分子式返回来。如果内部还有括号，同理，会进入再下一层函数。最后将括号内的值读入缓冲区。</p>

<p>遇到数字，就会继续往下读，直到把整个数字段都读出来（这个过程会转换为具体的数字<code>times</code>）。然后将缓冲区内的值乘以times算入结果，清空缓冲区（这里清空缓冲区是必要的，虽然读入下一个数据的时候会覆盖它，但是如果已经是最后一个数据，就会跳出循环，执行最后的缓冲区内数据算入结果，如果不清空会多算一次）。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cstdio&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;string&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#define ll long long
</span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
<span style="color:#66d9ef">char</span> in[<span style="color:#ae81ff">1000050</span>];
<span style="color:#66d9ef">int</span> len;
ll <span style="color:#a6e22e">cal</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>now){
    ll tmp<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,sum<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,times<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">for</span>(now;now<span style="color:#f92672">&lt;</span>len;){
        <span style="color:#66d9ef">if</span>(in[now]<span style="color:#f92672">&gt;=</span><span style="color:#e6db74">&#39;0&#39;</span><span style="color:#f92672">&amp;&amp;</span>in[now]<span style="color:#f92672">&lt;=</span><span style="color:#e6db74">&#39;9&#39;</span>){
            times<span style="color:#f92672">=</span>(in[now]<span style="color:#f92672">-</span><span style="color:#e6db74">&#39;0&#39;</span>);
            now<span style="color:#f92672">++</span>;
            <span style="color:#66d9ef">while</span>(in[now]<span style="color:#f92672">&gt;=</span><span style="color:#e6db74">&#39;0&#39;</span><span style="color:#f92672">&amp;&amp;</span>in[now]<span style="color:#f92672">&lt;=</span><span style="color:#e6db74">&#39;9&#39;</span>){
                times<span style="color:#f92672">*=</span><span style="color:#ae81ff">10</span>;
                times<span style="color:#f92672">+=</span>(in[now]<span style="color:#f92672">-</span><span style="color:#e6db74">&#39;0&#39;</span>);
                now<span style="color:#f92672">++</span>;
            }
            sum<span style="color:#f92672">+=</span>tmp<span style="color:#f92672">*</span>times;
            tmp<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
            <span style="color:#66d9ef">continue</span>;
        }
        <span style="color:#75715e">//遇到左括号时，先将缓冲区内部加入结果，然后进入下一层函数，计算内部分子式，遇到右括号再返回来
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span>(in[now]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;(&#39;</span>){
            sum<span style="color:#f92672">+=</span>tmp;
            now<span style="color:#f92672">++</span>;
            tmp<span style="color:#f92672">=</span>cal(now);
        }
        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(in[now]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;)&#39;</span>){
            sum<span style="color:#f92672">+=</span>tmp;
            now<span style="color:#f92672">++</span>;
            <span style="color:#66d9ef">return</span> sum;
        }
        <span style="color:#75715e">//遇到常规字符也是把上一个缓冲区的内容加入结果，把当前的加入缓冲区，以处理后面可能会出现的数字
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span>(in[now]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;C&#39;</span>){
            sum<span style="color:#f92672">+=</span>tmp;
            tmp<span style="color:#f92672">=</span><span style="color:#ae81ff">13</span>;
            now<span style="color:#f92672">++</span>;
        }<span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(in[now]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;H&#39;</span>){
            sum<span style="color:#f92672">+=</span>tmp;
            tmp<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
            now<span style="color:#f92672">++</span>;
        }<span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(in[now]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;O&#39;</span>){
            sum<span style="color:#f92672">+=</span>tmp;
            tmp<span style="color:#f92672">=</span><span style="color:#ae81ff">17</span>;
            now<span style="color:#f92672">++</span>;
        }
    }
    sum<span style="color:#f92672">+=</span>tmp;
    <span style="color:#66d9ef">return</span> sum;
}
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">solve</span>(<span style="color:#66d9ef">int</span> T){
    scanf(<span style="color:#e6db74">&#34;%s&#34;</span>,in);
    len<span style="color:#f92672">=</span>strlen(in);
    <span style="color:#66d9ef">int</span> now<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
    printf(<span style="color:#e6db74">&#34;%lld&#34;</span>,cal(now));
}
<span style="color:#66d9ef">signed</span> <span style="color:#a6e22e">main</span>(){
    <span style="color:#66d9ef">int</span> t<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
    <span style="color:#75715e">//scanf(&#34;%d&#34;,&amp;t);
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;i<span style="color:#f92672">&lt;=</span>t;i<span style="color:#f92672">++</span>){
        solve(i);
    }
}
</code></pre></div>
    </article>

    


    <ul class="pager article-pager">
      <li class="pager-newer pager-noitem">&lt; Newer</li>
      <li class="pager-older">
        <a href="/post/atabc174-e/" data-toggle="tooltip" data-placement="top" title="AtABC174 E-二分查找">Older &gt;</a>
      </li>
    </ul>
  </div>

<script src="https://cdn.bootcss.com/highlight.js/9.18.1/highlight.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</body>
</html>
